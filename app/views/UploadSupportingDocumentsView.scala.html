@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.FrontendAppConfig
@import models.fileupload._
@import components._
@import controllers.fileupload.routes.UploadSupportingDocumentsController

@this(  mainLayout: templates.Layout,
        formHelper: FormWithCSRF,
        govukButton: GovukButton,
        govukErrorSummary: GovukErrorSummary,
        caption: Caption,
        heading: Heading,
        cancelApplicationLink: CancelApplicationLink,
        paragraph: Paragraph,
        list: BulletList
    )

@(upscanInitiateResponse : UpscanInitiateResponse, uploadId: UploadId, status : UploadStatus)(implicit messages: Messages, appConfig: FrontendAppConfig, requestHeader: RequestHeader)

@formInputClass = @{
    if(UploadStatus.isError(status)) {
        "govuk-file-upload govuk-file-upload--error"
    } else {
        "govuk-file-upload"
    }
}

@refreshHeader = {
    <meta http-equiv="refresh" content="3"/>
   }   

@formGroupClass = @{
    if(UploadStatus.isError(status)) {
        "govuk-form-group govuk-form-group--error"
    } else {
        "govuk-form-group"
    }
}

@continueButton = @{govukButton(
    ButtonViewModel(
        if(status == InProgress) {
            messages("uploadSupportingDocuments.button.inProgress")
        } else {
            messages("uploadSupportingDocuments.button")
        }    
        )
        .preventingDoubleClick()
        .withAttribute(("id" -> "submit"))
        .disableIf(status == InProgress)
)}

@mainLayout(pageTitle = titleNoForm(messages("uploadSupportingDocuments.title")), additionalHeadBlock = {
    status match {
        case InProgress => Some(refreshHeader)
        case _ => None
        }
    }) {

    <form action="@upscanInitiateResponse.postTarget" method="post" enctype="multipart/form-data">
        @if(UploadStatus.isError(status)) {
            @govukErrorSummary(ErrorSummaryViewModel.withoutForm(UploadStatus.toFormErrors(status)))
        }

        @caption(messages("uploadSupportingDocuments.caption"))
        @heading(messages("uploadSupportingDocuments.heading"))

        @paragraph(Html(messages("uploadSupportingDocuments.paragraph.1")))
        @list(Seq(
                Html(messages("uploadSupportingDocuments.bulletPoint.1")),
                Html(messages("uploadSupportingDocuments.bulletPoint.2")),
            ),
            "govuk-list govuk-list--bullet",
        )

        @paragraph(Html(messages("uploadSupportingDocuments.paragraph.2")))
        @list(Seq(
            Html(messages("uploadSupportingDocuments.bulletPoint.3")),
            Html(messages("uploadSupportingDocuments.bulletPoint.4"))
            ),
            "govuk-list govuk-list--bullet",
        )

        @for(field <- upscanInitiateResponse.formFields) {
            <input type="hidden" name="@field._1" value="@field._2"/>
        }

        <div class="mt-3">
            <div class="@formGroupClass">
                @if(UploadStatus.isError(status)) {
                    <p id="file-input-error" class="govuk-error-message">
                        <span class="govuk-visually-hidden">Error:</span> @{messages(UploadStatus.message(status))}
                    </p>
                }
                
                @if(status != InProgress) {
                    <label class="govuk-label" for="file-input">
                        @messages("uploadSupportingDocuments.label")
                    </label>
                    <div class="form-control-wrapper">
                        <input
                                class="@formInputClass"
                                type="file"
                                id="file-input"
                                name="file"
                                accept=".pdf,.doc,.docx,.xlsx,.xls,.png,.jpeg,.jpg,.txt"
                        />
                    </div>
                }
                
            </div>

        </div>

        @continueButton
         </form>

    @cancelApplicationLink()
}
